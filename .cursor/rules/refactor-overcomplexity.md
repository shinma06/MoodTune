# 過剰な複雑さの洗い出し・対処

## 目的
このプロジェクトにおいて、**機能要件に対して必要以上に複雑になっている実装**を特定し、シンプルにしつつ要件は変えずに整理する。

## リファクタの前提（厳守）
1. **要件は変えない**  
   ユーザーから見える振る舞い・仕様は維持する。機能の追加・削除・変更は行わない。
2. **適切な実装には手を入れない**  
   すでにシンプルで読みやすい・保守しやすい実装は、無理に変更しない。「複雑だから」という理由だけでリファクタしない。

## 実施手順

### 1. 過剰な複雑さの基準
次のいずれかに当てはまる処理を「過剰に複雑」とみなして候補にする。
- **決定的なマッピングなのに実行時計算している**  
  例: (A, B) の組み合わせで結果が常に一意なのに、if/switch や関数で毎回計算している → 静的なテーブル・定数で表現できる。
- **同じ導出が複数箇所で重複している**  
  例: 同じ入力から同じ値を算出するロジックが 2 箇所以上にあり、単一ソースにまとめられる。
- **要件を満たすのに不要な抽象化がある**  
  例: 現状 1 種類のケースしかないのに汎用層・ファクトリ・多段のインターフェースがある。
- **読むだけで分かることを動的に判定している**  
  例: 設定や組み合わせが固定なのに、実行時にフラグや条件分岐で判定している。

### 2. 対象の絞り込み
- 上記の基準で怪しいファイル・関数・フローを洗い出す。
- 該当しそうな箇所について、**現在の要件（仕様・ドキュメント）** と照らし、「この複雑さが本当に必要か」を確認する。
- 要件上必要な複雑さ（将来拡張の前提が明示されている、パフォーマンス・セキュリティ上の理由がある等）は対象外とする。

### 3. 対処方針
- **候補ごとに**「何が過剰か」「どうシンプルにするか」を 1〜2 文で書く。
- 変更案は「要件は変えず、実装だけ簡略化する」範囲に留める。
- 既に適切な実装と判断した箇所は、「変更しない」と明記する。

### 4. 出力形式
- **変更する候補**: ファイル名・関数名（または該当範囲）と、過剰な点・提案する簡略化を箇条書き。
- **変更しないと判断した箇所**: 理由を 1 行で記載（任意だが推奨）。
- 実際にコードを書き換える場合は、上記の前提と手順に沿っていることを短く説明する。

### 5. 本プロジェクトでの適用例（参考）

- **決定的なマッピングの静的化**: `weather-background.ts` の `BACKGROUNDS`、`weather-utils.ts` の `WEATHER_ICON_MAP` / `WEATHER_THEME_COLORS` は、天気×時間帯など入力が決まれば出力が一意のため、静的定数として定義済み。
- **単一ソースの集約**: `effectiveWeather` / `effectiveTimeOfDay` / `isDark` は WeatherContext で算出し、PlaylistExplorer・WeatherMonitor・WeatherMoodTuningPanel・WeatherAnimation が参照。同じ導出を各コンポーネントで持たない。
