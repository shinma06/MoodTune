# Project Brief

## プロジェクト名

MoodTune - 天気 × 時間でプレイリスト提案

## 核心的なゴール

天気と時間に応じて動的に変化する背景色とアニメーションを備えた、音楽プレイリスト探索アプリケーション。ユーザーの現在の環境（天気、時間帯）に合わせて、適切な音楽プレイリストを視覚的に提案する。

## 主要要件

### 機能要件（現在の実装）

1. **天気連動システム**
   - 位置情報から現在の天気を取得（OpenWeatherMap API）。都市名は Google Geocoding API（逆ジオコーディング）で取得し、取得できない場合は OpenWeatherMap の地名を表示
   - 天気タイプは日本の主要気象に絞り対応（Clear, Clouds, Rain, Drizzle, Thunderstorm, Snow, Mist, Fog, Haze など）
   - 時間帯（朝/昼/夕方/夜）に応じた背景色の動的変化
   - 表示用時刻は `displayHour` で単一ソース化（マウント時・1分ごとに更新）

2. **視覚的フィードバック**
   - 天気と時間帯に応じたグラデーション背景（top, from, via, to）。暗い背景時はテキスト色を自動調整
   - 各天気タイプに応じたアニメーション（雨、雪、雲、霧など）
   - 天気アイコンのテーマカラー表示。Clear かつ夜は月アイコン

3. **プレイリスト探索 UI**
   - レコード盤風のインタラクティブ UI（スワイプ/ドラッグで切り替え）
   - **Favorite Music パネル**（右下）: 21 ジャンルから 1〜8 個選択可能。選択は localStorage に永続化。0 件はセッション内のみ許可（警告表示・パネル閉じ不可）。読み込み時に空配列はデフォルト（J-POP）に修復
   - 天気・時間・選択ジャンルに応じて AI（OpenAI）でタイトル/検索クエリ生成。Spotify API で画像取得（未連携時はモック画像）
   - パネル閉じ時はジャンル差分のみ API 呼び出し（追加ジャンルのみ生成）。レコード右 3 周で表示中ジャンル単体再生成、左 3 周で全件再生成
   - 時間帯・天気の変化でプレイリスト自動更新（Mood Tuning 手動中は対象外）

4. **Mood Tuning パネル**（左下）
   - 天気タイプと時間帯を手動で設定。選択時に即座に Context に反映（プレイリストはパネル閉じ時のみ再生成）
   - 「実際の天気・時間に戻す」ボタンは、パネルを開いた時点で実際の天気・時間と違う状態を設定していた場合のみ表示
   - 自動更新 ON/OFF（実時刻・天気変化時のプレイリスト再生成の有無）

5. **認証・モード**
   - Spotify 連携時: NextAuth で Spotify ログイン。未ログイン時はログイン画面
   - モックモード（`NEXT_PUBLIC_USE_MOCK_SPOTIFY !== "false"`）: ログイン不要でプレイリスト表示・開発が可能

### 今後のビジョン（未実装）

- プレイリストの実際の音楽再生機能
- ユーザー設定（位置情報の再取得、天気更新間隔など）
- オフライン対応
- プッシュ通知（天気変化の通知など）
- プレイリストの Spotify 保存

### 非機能要件

- レスポンシブデザイン（モバイル・デスクトップ対応）
- パフォーマンス最適化（アニメーションの軽量化）
- アクセシビリティ（キーボード操作、スクリーンリーダー対応）

## 技術的制約

- Next.js 15 App Router 必須
- TypeScript 必須
- shadcn/ui コンポーネントライブラリ使用
- Tailwind CSS のみでスタイリング（カスタム CSS 最小限）
