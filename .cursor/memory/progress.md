# Progress

## 実装済み機能（現在の実装）

### コア機能
- ✅ 位置情報から天気データ取得（OpenWeatherMap API）。都市名は Google Geocoding API（逆ジオコーディング）で取得、失敗時は OpenWeatherMap の地名にフォールバック
- ✅ 天気タイプ対応（日本の主要気象に絞り: Clear, Clouds, Rain, Drizzle, Thunderstorm, Snow, Mist, Fog, Haze など）
- ✅ 時間帯（朝/昼/夕方/夜）の自動判定（displayHour で単一ソース、1分ごとに更新）
- ✅ 天気と時間帯に応じた背景色の動的変化（4色グラデーション）
- ✅ 天気アイコンの表示とテーマカラー
- ✅ Clear かつ夜の場合の月アイコン表示
- ✅ 暗い背景時のテキスト色自動調整（effectiveWeather / effectiveTimeOfDay / isDark）

### UI/UX
- ✅ レコード盤風のプレイリスト探索 UI
- ✅ スワイプ/ドラッグでプレイリスト切り替え（45° 閾値）
- ✅ **Favorite Music パネル**（右下）: 21 ジャンルから 1〜8 個選択、選択解除で 0 件も許可（警告・パネル閉じ不可）
- ✅ **Mood Tuning パネル**（左下）: 天気・時間帯の手動設定、実際の天気・時間に戻すボタン（条件付き表示）
- ✅ 天気モニター（日時、気温、都市名、天気アイコン）
- ✅ パネル展開ボタンは角丸・アイコン比率を維持したサイズ（2.8rem / rounded 1.1rem）

### プレイリスト生成・更新
- ✅ AI（OpenAI / Vercel AI SDK）によるジャンル別タイトル・検索クエリ生成
- ✅ Spotify API でカバー画像取得（モック時は picsum）
- ✅ ジャンル選択の localStorage 永続化（空配列は永続化として無効、読み込み時にデフォルトへ修復）
- ✅ パネル閉じ時のジャンル差分更新（追加ジャンルのみ API 呼び出し）
- ✅ レコード右 3 周で表示中ジャンル単体再生成、左 3 周で全件再生成
- ✅ 時間帯・天気の変化でプレイリスト自動更新（Mood Tuning 手動中は対象外）
- ✅ 初回読み込み後の localStorage と表示プレイリストの同期

### アニメーション
- ✅ 雨のアニメーション（Rain, Drizzle, Thunderstorm）
- ✅ 雪のアニメーション（Snow）
- ✅ 雲のアニメーション（Clouds）
- ✅ 霧/もやのアニメーション（Mist, Fog, Haze）
- ✅ 砂塵のアニメーション（Dust, Sand）
- ✅ 竜巻のアニメーション（Tornado）
- ✅ スコールのアニメーション（Squall）
- ✅ 雷のフラッシュ効果（Thunderstorm）
- ✅ 画面の水滴効果（Rain, Thunderstorm）
- ✅ レコードのアイドル時自動回転（12 秒/周）、ドラッグで停止

### 背景色・レコード色
- ✅ 全天気タイプ×全時間帯の背景色定義
- ✅ グラデーション上部の視認性確保（getTopColor で dusk 時など暗い扱いを拡張）
- ✅ レコード色: 初期同期時の stale J-POP と空状態は現実のレコード色、それ以外は表示中ジャンルのテーマカラー

### 認証・モード
- ✅ Spotify 認証（NextAuth）
- ✅ モックモード（NEXT_PUBLIC_USE_MOCK_SPOTIFY）でログイン不要で利用可能

---

## 今後のビジョン（未実装）

- プレイリストの実際の音楽再生機能
- ユーザー設定（位置情報の再取得、天気更新間隔など）
- オフライン対応
- プッシュ通知（天気変化の通知など）
- プレイリストの Spotify 保存
- トークンリフレッシュの堅牢化

## 既知のバグ・課題

- なし（現在のところ）

## 技術的負債

- なし（現時点）

## パフォーマンス最適化の余地

- アニメーション要素数の最適化（必要に応じて）
- 画像の最適化（プレイリストカバー画像）
